/**
 * Simpli.js
 * A small library consists of some useful and shorthand function
 *
 * Copyright (c) 2016 Yu H.
 * 
 * @author Yu H.
 * @version 1.2.4
 * @license The MIT License (MIT)
 * https://opensource.org/licenses/MIT
 **/
"undefined"==typeof Object.create&&(Object.create=function(e){function r(){}return r.prototype=e,new r}),"undefined"==typeof String.prototype.nthIndexOf&&(String.prototype.nthIndexOf=function(e,r,t){var n,i,o,a=[],s=0;if(0===r)throw new TypeError("nthIndex cannot be 0 in String.nthIndexOf(searchValue, nthIndex, start)");for(n="undefined"==typeof t?-1:t-1,i=this.length;i>n;){if(n=this.indexOf(e,n+1),s+1===r)return n;if(-1===n)break;a[s++]=n}return 0>r&&(o=s+r,o>=0)?a[o]:-1});var getStackTrace=function(){var e=function(){return"undefined"!=typeof console?("undefined"==typeof console.debug&&(console.debug=console.log),console):{log:function(e){},info:function(e){},warn:function(e){},error:function(e){},debug:function(e){}}},r=new RegExp("^\\s+|\\s+$","g"),t=function(e){var t=Object.toString.call(e);return t=t.slice(t.indexOf("function")+8),callerName=t.slice(0,t.indexOf("(")).replace(r,""),0===callerName.length?"anonymous":callerName},n=new RegExp("^(?:\\s*at\\s?(.*)\\s|(.*)@)\\(?(.*):([1-9][0-9]*):([1-9][0-9]*)\\)?$"),i=function(e){var r,t=e.match(n);return null===t?null:(r="undefined"==typeof t[1]?t[2]:t[1],{invokedBy:""===r?"anonymous":r,file:t[3],line:t[4],column:t[5]})};return function(){var r,o,a,s,u,l=[],c=!0;try{var f;f.bar.baz=1}catch(g){if("undefined"!=typeof g.stack)for(c=!1,r=g.stack.split("\n"),s=null===r[0].match(n)?2:1,u=r.length;u>s&&0!==r[s].length;s++){if(a=i(r[s]),null===a){c=!0;break}"getStackTrace"!==a.invokedBy&&l.push(a)}if(c){e().error("[Warning] getStackTrace() running in compatibility mode");try{o=arguments.callee}catch(g){return e().error("[Warning] getStackTrace() compatibility mode cannot be run in strict mode"),null}for(;o.caller;)o=o.caller,l.push({invokedBy:t(o),file:void 0,line:void 0,column:void 0})}}return l}}();!function(e,r){"use strict";var t=Object.prototype.toString,n=Object.prototype.hasOwnProperty,i="undefined"!=typeof window?window:e,o=r.simpli,a=function(){};a.version="1.2.4",a.noConflict=function(){return r.simpli=o,a},a.console=function(){return a.isDefined(console)?(a.isDefined(console.debug)||(console.debug=console.log),console):{log:function(e){},info:function(e){},warn:function(e){},error:function(e){},debug:function(e){}}},a.forEachProperty=function(e,r){a.argc(arguments,["object","function"]);for(var t in e)n.call(e,t)&&r.call(e,t,e[t])},a.detailTypeOf=function(e){var r,t,n,i="array";if(a.isArray(e)){for(t=0,n=e.length;n>t;t++)"array"===i?i=a.getClass(e[t]):i!==a.getClass(e[t])&&(i="mixed");r=i+"["+e.length+"]"}else r=a.getClass(e);return r.toLowerCase()},a.getClass=function(r){var n=t.call(r);return r===e||r===i?"Global":n.slice(8,-1)},a.isA=function(e,r){if(!a.isString(r)&&!a.isFunction(r))throw new TypeError("Expected argument 2 to be 'string' or constructor, '"+a.detailTypeOf(className)+"' given");return a.isString(r)?a.getClass(e)===r:e instanceof r},a.isArguments=function(e){return a.isA(e,"Arguments")||!a.isA(arguments,"Arguments")&&a.isDefined(e)&&n.call(e,"callee")},a.argumentsToArray=function(e){var r,t,n=[];for(r=0,t=e.length;t>r;r++)n.push(e[r]);return n},a.isMixed=function(e){return"undefined"!=typeof e},a.isNull=function(e){return null===e},a.isDefined=function(e){return"undefined"!=typeof e},a.isDeepDefined=function(){var e,r,t,n=arguments.length;if(1>n)throw new TypeError("Expected argument 1 to have at least  1 object, 0 given");for(e=arguments[0],t=1;n>t;t++){if(r=arguments[t],!a.isInteger(r)&&!a.isString(r))throw new TypeError("Expected argument "+t+" to be 'integer' or 'string', "+typeof r+" given");if(e=e[r],!a.isDefined(e))return!1}return!0},a.isSet=function(e){return a.isDefined(e)&&!a.isNull(e)},a.isNaN=function(e){return e!==e},a.isObject=function(e){return"object"==typeof e&&!a.isArray(e)&&null!==e},a.isNumber=function(e){return"number"==typeof e},a.isFunction=function(e){return"function"==typeof e},a.isBoolean=function(e){return"boolean"==typeof e},a.isArray=function(e){var r=a.getClass(e);return"Array"===r?!0:"Array"!==a.getClass([])&&"Object"===r?a.isObject(e)&&a.isNumber(e.length):!1},a.isString=function(e){return"string"==typeof e},a.isInteger=function(e){return a.isNumber(e)&&e%1===0},a.isDecimal=function(e,r,t){var n,i=!1,o=!1;if(!a.isNumber(e))return!1;if(n=(e+"").split("."),a.isDefined(r)&&(i=!0,!a.isInteger(r)))throw new TypeError("Expected argument 2 to be 'integer', '"+a.detailTypeOf(r)+"' given");if(a.isDefined(t)&&2===n.length&&(o=!0,!a.isInteger(t)))throw new TypeError("Expected argument 3 to be 'integer', '"+a.detailTypeOf(t)+"' given");return i||o?(i?n[0].length===r:!0)&&(o?2===n.length?n[1].length<=t:!1:!0):!0},a.isChar=function(e){return a.isString(e)&&1===e.length},a.isObjectArray=function(e,r){var t,n;if(!a.isArray(e))return!1;if(n=e.length,a.isDefined(r)){if(!a.isInteger(r))throw new TypeError("Expected arugment 2 to be 'interger', '"+a.detailTypeOf(r)+"' given");if(n!==r)return!1}for(t=0;n>t;t++)if(!a.isObject(e[t]))return!1;return!0},a.isNumberArray=function(e,r){var t,n;if(!a.isArray(e))return!1;if(n=e.length,a.isDefined(r)){if(!a.isInteger(r))throw new TypeError("Expected arugment 2 to be 'interger', '"+a.detailTypeOf(r)+"' given");if(n!==r)return!1}for(t=0;n>t;t++)if(!a.isNumber(e[t]))return!1;return!0},a.isFunctionArray=function(e,r){var t,n;if(!a.isArray(e))return!1;if(n=e.length,a.isDefined(r)){if(!a.isInteger(r))throw new TypeError("Expected arugment 2 to be 'interger', '"+a.detailTypeOf(r)+"' given");if(n!==r)return!1}for(t=0;n>t;t++)if(!a.isFunction(e[t]))return!1;return!0},a.isBooleanArray=function(e,r){var t,n;if(!a.isArray(e))return!1;if(n=e.length,a.isDefined(r)){if(!a.isInteger(r))throw new TypeError("Expected arugment 2 to be 'interger', '"+a.detailTypeOf(r)+"' given");if(n!==r)return!1}for(t=0;n>t;t++)if(!a.isBoolean(e[t]))return!1;return!0},a.isIntegerArray=function(e,r){var t,n;if(!a.isArray(e))return!1;if(n=e.length,a.isDefined(r)){if(!a.isInteger(r))throw new TypeError("Expected arugment 2 to be 'interger', '"+a.detailTypeOf(r)+"' given");if(n!==r)return!1}for(t=0;n>t;t++)if(!a.isInteger(e[t]))return!1;return!0},a.isDecimalArray=a.isNumberArray,a.isStringArray=function(e,r){var t,n;if(!a.isArray(e))return!1;if(n=e.length,a.isDefined(r)){if(!a.isInteger(r))throw new TypeError("Expected arugment 2 to be 'interger', '"+a.detailTypeOf(r)+"' given");if(n!==r)return!1}for(t=0;n>t;t++)if(!a.isString(e[t]))return!1;return!0};var s={};s.INVALID_ARGUMENT=function(){return this instanceof s.INVALID_ARGUMENT?(this.index=-1,this.message="",void(this.error="")):new s.INVALID_ARGUMENT},s.INVALID_ARGUMENT.prototype.getMessage=function(){return this.message},s.INVALID_ARGUMENT.prototype.getIndex=function(){return this.index},s.INVALID_ARGUMENT.prototype.getError=function(){return this.error},s.MISMATCH_ARGNUMBER=function(e,r,t){var n,i;if(!(this instanceof s.MISMATCH_ARGNUMBER))return new s.MISMATCH_ARGNUMBER(e,r,t);for(s.INVALID_ARGUMENT.call(this),t=t||!1,i=e.length,this.message="Argument number mismatch: Expected "+(this.isLowerBound?"at least ":"")+r+" argument(s), "+i+" given",this.error=a.argv.MISMATCH_ARGNUMBER,n=0;i>n;n++)e[n].valid=!1,e[n].error=a.argv.MISMATCH_ARGNUMBER},s.MISMATCH_ARGNUMBER.prototype=Object.create(s.INVALID_ARGUMENT.prototype),s.MISMATCH_ARGNUMBER.prototype.constructor=s.MISMATCH_ARGNUMBER,s.UNEXPECTED_DATATYPE=function(e,r){var t;return this instanceof s.UNEXPECTED_DATATYPE?(s.INVALID_ARGUMENT.call(this),t=e[r],this.index=r,this.message="Expected '"+t.expected+"', '"+t.given+"' given",void(this.error=e[r].error=a.argv.UNEXPECTED_DATATYPE)):new s.UNEXPECTED_DATATYPE(e,r)},s.UNEXPECTED_DATATYPE.prototype=Object.create(s.INVALID_ARGUMENT.prototype),s.UNEXPECTED_DATATYPE.prototype.constructor=s.UNEXPECTED_DATATYPE,s.invalidHandler=function(e,r,n,i){var o,s,u,l,c,f,g,p,d,y,E,h="",T="",m="",A="";for(l=e.getMessage(),c=e.getIndex(),o=0,s=r.length,f="";s>o;)g=r[o].value,g=a.isString(g)?'"'+g+'"':a.isNumber(g)?g:t.call(g),f+=o===c?"-->"+g+"<--":g,++o<s&&(f+=", ");if(p=getStackTrace(),!a.isNull(p))for(d=!1,o=0,s=p.length;s>o;o++)if(p[o].invokedBy===n||p[o].invokedBy==="Function."+n){d=!0,u=o+1,T=p[u].file,m=p[u].line,A=p[u].column,h+=n+"("+f+"): "+l+" in "+T+" on line "+m;break}for((a.isNull(p)||!d)&&(h+=n+"("+f+"): "+l),y={arguments:[],invokedBy:n,file:T,line:m,column:A},o=0,s=r.length;s>o;o++)E=r[o],y.arguments.push({valid:E.valid,index:E.index,value:E.value,expected:E.expected,given:E.given}),a.isDefined(E.error)&&(y.arguments[o].error=E.error);if(a.isNull(i)||i.call(null,y),a.argv.errorMode()===a.argv.ERRMODE_ERROR)throw new TypeError(h);return!1},s.isType=function(e,r,t){if(a.isA(r,a.Type))return r.is(e);switch(r){case"*":return a.isMixed(e);case"array":return a.isArray(e);case"null":return a.isNull(e);case"object":return a.isObject(e);case"number":return a.isNumber(e);case"boolean":case"bool":return a.isBoolean(e);case"function":return a.isFunction(e);case"string":return a.isString(e);default:if(a.argv.mode()!==a.argv.MODE_EXTEND)throw new TypeError("Extend data type are not supported in Strict mode");switch(r){case"mixed":return a.isMixed(e);case"integer":case"int":return a.isInteger(e);case"decimal":case"float":case"double":return a.isDecimal(e);case"char":return a.isChar(e);case"mixed[]":return a.isArray(e,t);case"object[]":return a.isObjectArray(e,t);case"number[]":return a.isNumberArray(e,t);case"boolean[]":case"bool[]":return a.isBooleanArray(e,t);case"string[]":return a.isStringArray(e,t);case"integer[]":case"int[]":return a.isIntegerArray(e,t);case"decimal[]":case"float[]":case"double[]":return a.isDecimalArray(e,t);case"function[]":return a.isFunctionArray(e,t);case"char[]":if(!a.isString(e))return!1;if(a.isDefined(t))return e.length===t}}},s.typeRegEx=new RegExp("^(\\*|array|null|(mixed|object|number|boolean|bool|function|string|integer|int|decimal|float|double|char)(?:\\[([1-9][0-9]*)?\\])?)$"),s.optionalRegEx=/^\[[^\s]+\]$/,s.checkArg=function(e){var r,t,n,i,o,u,l=!1;for(e.optional&&!a.isDefined(e.value)&&(l=!0),r=0,t=e.signature.length;t>r;r++){if(i=e.signature[r],a.isA(i,a.Type))o=i;else{if(n=i.match(s.typeRegEx),null===n)throw new TypeError("Unrecognized data type '"+i+"'");if(l)continue;a.isDefined(n[3])&&""!==n[3]?(o=n[2]+"[]",u=parseInt(n[3])):(o=n[1],u=void 0)}s.isType(e.value,o,u)&&(l=!0)}return l},a.Type=function(e,r){if(!(this instanceof a.Type))return new a.Type(e,r);if(a.isString(e)){if(this._name=e,!a.isFunction(r))throw new TypeError("Expected argument 2 to be 'function', '"+typeof r+"' given");this._callback=r}else{if(!a.isFunction(e))throw new TypeError("Expected argument 1 to be 'string' or 'function', '"+typeof e+"' given");this._name="{simpli.Type}",this._callback=e}this._optional=!1,this._isArray=!1,this._size=0,this._repeatable=!1},a.Type.prototype._clone=function(){var e=new a.Type(this.getCallback());return e._optional=this.isOptional(),e._isArray=this.isArray(),e._size=this.getSize(),e._repeatable=this.isRepeatable(),e},a.Type.prototype._toFunction=function(){var e,r=this;return function(t){if(r.isOptional()&&!a.isDefined(t))return!0;if(r.isArray()){if(!a.isArray(t))return!1;if(e=r.getSize(),e>0&&t.length>e)return!1;for(var n=0;n<t.length;n++)if(!r.getCallback()(t[n]))return!1;return!0}return r.getCallback()(t)}},a.Type.prototype.getName=function(){return this._name},a.Type.prototype.isOptional=function(){return this._optional},a.Type.prototype.isArray=function(){return this._isArray},a.Type.prototype.getSize=function(){return this._size},a.Type.prototype.isRepeatable=function(){return this._repeatable},a.Type.prototype.getCallback=function(){return this._callback},a.Type.prototype.optional=function(){var e=this._clone();return e._optional=!0,e},a.Type.prototype.array=function(e){var r=this._clone();if(r._isArray=!0,a.isDefined(e)){if(!a.isInteger(e))throw new TypeError("Expected argument 1 to be 'integer', '"+typeof e+"'' given");if(0>=e)throw new TypeError("Expected argument 1 to be greater than 0, "+e+" given");r._size=e}else e="";return r._name=this.getName()+"["+e+"]",r},a.Type.prototype.repeatable=function(){var e=this._clone();return e._repeatable=!0,e},a.Type.prototype.is=function(e){return this._toFunction()(e)},a.argv=function(e){var r,t,n,i,o,u,l,c,f,g,p,d,y,E,h,T,m,A,v,b=a.argumentsToArray(arguments),w=b.length,D=null,N=[],R=null;if(!a.isArguments(e))throw new TypeError("Expected argument 1 to be 'Arguments' object, '"+a.detailTypeOf(e)+"' given");if(e=a.argumentsToArray(e),a.isFunction(b[w-1])&&(D=b[w-1],b.pop(),w--),w>2||2===w&&a.isString(b[1])||a.isA(b[1],a.Type))n=b,n.shift();else if(2!==w||!(n=b[1])||!a.isArray(n))throw new TypeError("Expected argument 2 to be 'string', 'array' or 'simpli.Type', '"+a.detailTypeOf(b[1])+"' given");for(i=e.length,o=a.isDefined(n)?n.length:0,r=0;i>r;r++)N.push({valid:!1,index:r,value:e[r],expected:"",given:a.detailTypeOf(e[r]),signature:null,optional:!1});for(p=0,g=!1,d=!1,u=0,l=0;o>u;){if(c=n[u],f=!1,a.isA(c,a.Type))f=c.isOptional(),p+=c.isRepeatable()?1:0,y=c.getName(),E=[c];else{if(!a.isString(c))throw new TypeError("Expected signature to be 'string' or 'simpli.Type', '"+a.detailTypeOf(c)+"' given");for(f=s.optionalRegEx.test(c)&&(c=c.slice(1,-1)),p+="..."===c.slice(0,3)&&(c=c.slice(3))?1:0,y=c.replace("|",","),E=c.split("|"),r=0,t=E.length;t>r;r++)if(!s.typeRegEx.test(E[r]))throw new TypeError("Expected signature to be one of the valid types, '"+E[r]+"' given")}if(i>l&&(N[l].expected=y,N[l].signature=E,N[l].optional=f),f)g=!0;else{if(g)throw new TypeError("Optional argument must appear at the end of the declaration");l===i&&(R=s.MISMATCH_ARGNUMBER(N,o,p))}if(1===p){if(d)throw new TypeError("Variable-length argument must be the last signature of the declaration");for(u+1!==o&&(d=!0),l+=1;i>l;l++)N[l].expected=y,N[l].signature=E,N[l].optional=f}else if(2===p)throw new TypeError("Only one variable-length argument is allowed in the declaration");u++,l++}if(i>l&&(R=s.MISMATCH_ARGNUMBER(N,o)),a.isNull(R))for(r=0,t=N.length;t>r;r++)if(h=N[r],!s.checkArg(h)){a.isNull(R)&&(R=s.UNEXPECTED_DATATYPE(N,r));break}if(!a.isNull(R)){if(T=getStackTrace(),!a.isNull(T))for(m=!1,A=T.length,r=0;A>r;r++)("simpli.argv"===T[r].invokedBy||"Function.simpli.argv"===T[r].invokedBy)&&(m=!0,v=T[r+1].invokedBy);return(a.isNull(T)||!m)&&(v="function"),s.invalidHandler(R,N,v,D)}return!0},a.argv.UNEXPECTED_DATATYPE="{UNEXPECTED_DATATYPE}",a.argv.MISMATCH_ARGNUMBER="{MISMATCH_ARGNUMBER}",a.argv.MODE_STRICT="{MODE_STRICT}",a.argv.MODE_EXTEND="{MODE_EXTEND}",a.argv.ERRMODE_ERROR="{ERRMODE_ERROR}",a.argv.ERRMODE_SILENT="{ERRMODE_SILENT}",a.argv.mode=function(e){if(a.isDefined(e)){if(e!==a.argv.MODE_STRICT&&e!==a.argv.MODE_EXTEND)throw new TypeError("Unrecognized mode '"+e+"'");s.mode=e}return s.mode},a.argv.errorMode=function(e){if(a.isDefined(e)){if(e!==a.argv.ERRMODE_ERROR&&e!==a.argv.ERRMODE_SILENT)throw new TypeError("Unrecognized error mode '"+e+"'");s.errorMode=e}return s.errorMode},a.argv.mode(a.argv.MODE_EXTEND),a.argv.errorMode(a.argv.ERRMODE_ERROR),r.simpli=a,"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=a),exports.simpli=a)}("undefined"==typeof window?global:window,this);
